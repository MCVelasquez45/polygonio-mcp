# GPT-5 + OpenAI Agents SDK + Polygon.io MCP Server — Agentic Financial Analyst Demo

<div align="center">
  <img src="../../../images/logo.png" alt="Project Logo" width="100%"/>
</div>

A simple Python CLI for natural language financial queries using [GPT‑5](https://openai.com/gpt-5/) via the [OpenAI](https://openai.com/) [Agents SDK](https://openai.github.io/openai-agents-python/) and the [Polygon.io](https://polygon.io/) [MCP server](https://github.com/polygon-io/mcp_polygon). It also supports saving analyses as Markdown reports.

## Features

- **Ask questions like:**  
  - `options snapshot for AAPL`  
  - `intraday aggregates for MSFT 2024-03-18 minute`  
  - `list US options exchanges`
  - `compare META and MSFT fundamentals, review recent news, save a report`

- **Advanced options data tools:**  
  Purpose-built tools expose Polygon options snapshots, ticker sentiment, and FRED macro series so the agent can ground options analysis in live data (delta, IV, open interest, macro spreads, etc.).

- **Order flow, exchanges, and fundamentals:**  
  Additional tools retrieve contract-level options quotes/trades, intraday bars for underlyings, exchange metadata, dividends, and full financial statements.

- **Rich CLI output:**  
  Answers are formatted for easy reading in your terminal.

- **Save Markdown reports:**  
  Ask the agent to save its analysis and it will write a Markdown report under `reports/<category>/...`.

## Disclaimer

**Warning:** The examples, demos, and outputs produced with this project are generated by artificial intelligence and large language models. You acknowledge that this project and any outputs are provided "AS IS", may not always be accurate and may contain material inaccuracies even if they appear accurate because of their level of detail or specificity, outputs may not be error free, accurate, current, complete, or operate as you intended, you should not rely on any outputs or actions without independently confirming their accuracy, and any outputs should not be treated as financial or legal advice. You remain responsible for verifying the accuracy, suitability, and legality of any output before relying on it.

---

## Quickstart (with [uv](https://github.com/astral-sh/uv))

1. **Install [uv](https://github.com/astral-sh/uv) if you don’t have it:**
    ```sh
    curl -Ls https://astral.sh/uv/install.sh | sh
    ```

2. **Get your API keys:**
   - [OpenAI API key](https://platform.openai.com/api-keys)
   - [Polygon.io API key](https://polygon.io/)
   - [FRED API key](https://research.stlouisfed.org/docs/api/api_key.html) (needed for macro data)

3. **Create a `.env` file in the same directory as `main.py`:**
    ```
    OPENAI_API_KEY=sk-...
    POLYGON_API_KEY=your_polygon_api_key_here
    FRED_API_KEY=your_fred_api_key_here
    ```
    All three keys unlock the full toolset; Polygon and OpenAI are required, FRED is required for macro queries.

4. **Run the CLI (dependencies will be auto-installed from `pyproject.toml`):**
    ```sh
    uv run main.py
    ```

5. **Type your question and press Enter!**  
   Type `exit` to quit.

---

## Example Usage

```
> options snapshot for NVDA
✔ Query processed successfully!
Agent Response:
Top NVDA contracts ranked by gamma with implied volatility and NBBO spreads…
---------------------

> exit
Goodbye!
```

For reference, the analysis agent follows instruction steps like:

```
1. Verify finance-related using guardrail
2. Gather market data with Polygon.io tools
3. Include disclaimers
4. Offer to save reports when appropriate
```

Be specific in your prompt. The better the prompt — the better the response.

Putting in `Do a return on investment analysis of Meta vs Microsoft. Review news, sentiment, rating, earnings. Analyze the results. Save a report. ` will result in a report similar to what exists in example.md in the reports folder of this repo.

<div align="center">
  <img src="../gpt5-openai-agents-sdk-polygon-mcp/images/example.png" alt="Example" width="100%"/>
</div>

---

## Troubleshooting

- **Missing API Key:**  
  If you see an error about `POLYGON_API_KEY`, `OPENAI_API_KEY`, or `FRED_API_KEY`, make sure your `.env` file is in the same directory and contains the right values:
  ```
  OPENAI_API_KEY=sk-...
  POLYGON_API_KEY=your_polygon_api_key_here
  FRED_API_KEY=your_fred_api_key_here
  ```

- **`uvx: command not found`:**  
  Install `uv` with `pipx install uv` or `pip install uv`.

- **Dependencies:**  
  `uv run` will install from `pyproject.toml`. If you prefer pip:
  ```sh
  pip install openai-agents pydantic rich python-dotenv openai httpx
  python main.py
  ```

- **Guardrail blocks non‑finance prompts:**  
  Try a market or finance-related query.

- **Polygon endpoint returns 403/404:**  
  Some `/vX/...` endpoints require higher entitlements. The agent automatically falls back to `/v3/...` when possible; otherwise upgrade access or remove that tool call.

- **Other errors:**  
  All errors are printed in red in the terminal for easy debugging.

---

## How it Works

- Loads your OpenAI and Polygon API keys from `.env`.
- Connects to the FRED API (via `FRED_API_KEY`) for macroeconomic time series requested by the agent.
- Starts the Polygon MCP server over stdio: `uvx --from git+https://github.com/polygon-io/mcp_polygon@v0.4.0 mcp_polygon` (no manual server setup).
- Runs a GPT‑5 analysis agent (OpenAI Agents SDK) with a finance guardrail and tools.
- Gives the agent direct access to custom tools:
  - `get_polygon_options_snapshot` (strike, IV, greeks, OI)
  - `get_polygon_option_contract_snapshot` (full contract snapshot with day stats)
  - `get_polygon_option_quotes` & `get_polygon_option_trades` (NBBO + tape insight)
  - `get_polygon_intraday_aggregates` (intraday or multi-day candlesticks)
  - `get_polygon_exchanges` (exchange metadata by asset class)
  - `get_polygon_ticker_sentiment` (headline coverage with metadata)
  - `get_polygon_dividends`, `get_polygon_earnings`, `get_polygon_financials` (corporate events & reports)
  - `get_fred_series` & `get_fred_release_calendar` (macro series and upcoming releases)
- Can save formatted analyses via `save_analysis_report` to `reports/<category>/...`.
- Persists short‑term session context while the CLI runs and renders rich output.

---

## Enhancements

This demo is a simple one file demonstration to showcase the art of the possible. There are several enhancements that could be made. 

- Multi-agent handoffs: Delegate to specialized agents (news, fundamentals, technicals) for better results.
- LLM context clearing between topic changes
- Stronger guardrails
- Report output models using Pydantic
- Config and limits: YAML/ENV config for model, date-range caps, per-tool rate limits, and retries.

---
## License

This project is licensed under the [MIT License](../../../LICENSE).
